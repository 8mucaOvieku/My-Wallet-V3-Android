apply plugin: 'embrace-swazzler'

import groovy.json.JsonOutput

/**
 * Embrace.io requires a config file in app/src/main/embrace-config.json
 * Creating a dummy configuration file, if the real one doesn't exist.
 */
task generateEmbraceConfigurationFile(type:Exec) {
    def jsonString =
            "{\n" +
            "  \"app_id\": \"xxxxx\",\n" +
            "  \"api_token\": \"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\"\n" +
            "}"

    def configFile = rootProject.file('app/src/main/embrace-config.json')
    if(!configFile.exists()) {
        configFile.write(JsonOutput.prettyPrint(jsonString))
    }
}

build.dependsOn generateEmbraceConfigurationFile

swazzler {
    variantFilter {
        if(it.name.toLowerCase().contains("debug")) {
            it.setSwazzlingEnabled(false)
        }
    }
    forceIncrementalOverwrite = false
    forceOkHttpWrapperInjection = true
    forceVolleyWrapperInjection = false
}